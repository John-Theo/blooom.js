{"version":3,"sources":["main.es.browser.js"],"names":["Blooom","[object Object]","selector","data","customConfig","sourceConfig","this","transformData","config","Config","handler","Handler","renderer","Renderer","dataNodes","dataLinks","washData","container","initCanvas","simulation","initSimulation","links","initLinks","nodes","initNodes","registerInteraction","renderTick","json","map","i","graph","forEach","concat","relationships","linkSourceKey","linkTargetKey","nodeGroupsKey","JSON","parse","loadNeo4j","results","linkedNodes","renameItemDict","source","target","d","push","Object","create","unique","existedNodes","existedGroups","labels","indexOf","id","filter","x","length","assign","flat","v","svg","d3","select","html","append","attr","width","node","clientWidth","height","clientHeight","forceSimulation","velocityDecay","force","forceLink","forceManyBody","strength","forceCenter","forceCollide","radius","iterations","selectAll","enter","call","drag","nodeGroup","circle","glow","colors","getNodeClassIndex","borderColors","label","text","getNodeText","linkGroup","arrow","linkLabelProperty","that","nodesLinked","index","on","focusLink","linkMouseEnter","removeFocus","linkMouseLeave","pinNode","fx","fy","y","focusNode","nodeMouseEnter","nodeMouseLeave","event","preventDefault","zoom","renderLink","configs","entries","k","c","rgb","darker","constructor","Array","getNodeLabel","properties","nodeLabelProperties","each","classList","add","remove","scaleExtent","scale","transform","active","alphaTarget","restart","removeNodePin","Utils","link","linkGlow","linkText","angle","utils","rotation","renderLinkText","renderLinkGlow","renderLinkArrow","nodeRadius","arrowSize","options","rel","outline","center","textBoundingBox","getBBox","u","unitaryVector","textMargin","n","unitaryNormalVector","rotatedPointA1","rotatePoint","rotatedPointB1","rotatedPointC1","rotatedPointD1","rotatedPointA2","rotatedPointB2","rotatedPointC2","rotatedPointD2","rotatedPointE2","rotatedPointF2","rotatedPointG2","rotatedPointA","rotatedPointB","rotatedPointC","rotatedPointD","mirror","nWeight","point","rotatedPoint","array","a","original","keys","defineProperty","getOwnPropertyDescriptor","Math","atan2","PI","newLength","sqrt","pow","vector","cx","cy","radians","cos","sin","p","rotate"],"mappings":"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","file":"main.es.browser.js","sourcesContent":["\r\nclass Blooom {\r\n  constructor(selector, data, customConfig) {\r\n    let sourceConfig;\r\n    [data, sourceConfig] = this.transformData(data);\r\n\r\n    this.config = new Config(this, sourceConfig, customConfig);\r\n    this.handler = new Handler(this);\r\n    this.renderer = new Renderer();\r\n\r\n    const [dataNodes, dataLinks] = this.washData(data);\r\n\r\n    this.container = this.initCanvas(selector);\r\n    this.simulation = this.initSimulation(dataNodes, dataLinks);\r\n    this.links = this.initLinks(dataLinks);\r\n    this.nodes = this.initNodes(dataNodes);\r\n\r\n    this.registerInteraction(dataLinks);\r\n    this.renderTick();\r\n  }\r\n\r\n  loadNeo4j(json) {\r\n    let nodes = [];\r\n    let links = [];\r\n\r\n    json\r\n      .map((i) => i.graph)\r\n      .forEach((i) => {\r\n        nodes = nodes.concat(i.nodes);\r\n        links = links.concat(i.relationships);\r\n      });\r\n\r\n    return [\r\n      { nodes, links },\r\n      {\r\n        linkSourceKey: \"startNode\",\r\n        linkTargetKey: \"endNode\",\r\n        nodeGroupsKey: \"labels\",\r\n      },\r\n    ];\r\n  }\r\n\r\n  transformData(data) {\r\n    let sourceConfig = {};\r\n    if (typeof data === \"string\") data = JSON.parse(data);\r\n\r\n    return (data[0] && data[0].graph)\r\n      ? this.loadNeo4j(data)\r\n      : (data.results && data.results[0])\r\n      ? this.loadNeo4j(data.results[0].data)\r\n      : null\r\n    ;\r\n  }\r\n\r\n  washData(data) {\r\n    let linkedNodes = [];\r\n    const dataLinks = renameItemDict(data.links, {\r\n      source: this.config.linkSourceKey,\r\n      target: this.config.linkTargetKey,\r\n    }).map((d) => {\r\n      linkedNodes.push(d.source), linkedNodes.push(d.target);\r\n      return Object.create(d);\r\n    });\r\n\r\n    linkedNodes = unique(linkedNodes);\r\n\r\n    let existedNodes = [];\r\n    let existedGroups = [];\r\n    const dataNodes = renameItemDict(data.nodes, {\r\n      labels: this.config.nodeGroupsKey,\r\n    })\r\n      .map((d) => {\r\n        if (existedNodes.indexOf(d.id) >= 0 || linkedNodes.indexOf(d.id) < 0)\r\n          return null;\r\n        existedNodes.push(d.id);\r\n        existedGroups.push(d[this.config.nodeGroupsKey]);\r\n        return Object.create(d);\r\n      })\r\n      .filter((x) => x);\r\n\r\n    this.existedGroups = existedGroups.length ? Object.assign(\r\n      ...unique(existedGroups.flat()).map((v, i) => ({ [v]: i }))\r\n    ) : [];\r\n\r\n    return [dataNodes, dataLinks];\r\n  }\r\n\r\n  initCanvas(selector) {\r\n    this.svg = d3\r\n      .select(selector)\r\n      .html(\"\")\r\n      .append(\"svg\")\r\n      .attr(\"class\", \"blooom\")\r\n      .attr(\"width\", \"100%\")\r\n      .attr(\"height\", \"100%\");\r\n\r\n    this.width = this.svg.node().clientWidth;\r\n    this.height = this.svg.node().clientHeight;\r\n    this.svg.attr(\"viewBox\", [0, 0, this.width, this.height]);\r\n\r\n    return this.svg.append(\"g\");\r\n  }\r\n\r\n  initSimulation(dataNodes, dataLinks) {\r\n    return (\r\n      d3\r\n        .forceSimulation(dataNodes)\r\n        .velocityDecay(0.1)\r\n        .force(\r\n          \"link\",\r\n          d3.forceLink(dataLinks).id((d) => d.id)\r\n        )\r\n        .force(\"charge\", d3.forceManyBody().strength(-800))\r\n        .force(\"center\", d3.forceCenter(this.width / 2, this.height / 2))\r\n        .force(\"collide\", d3.forceCollide().radius(40).iterations(2))\r\n    );\r\n  }\r\n\r\n  initNodes(dataNodes) {\r\n    const nodes = this.container\r\n      .selectAll(\".node\")\r\n      .data(dataNodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"node\")\r\n      .call(this.handler.drag(this.simulation));\r\n\r\n    this.nodeGroup = {\r\n      circle: nodes.append(\"circle\").attr(\"class\", \"glow\").attr(\"r\", 25),\r\n      glow: nodes\r\n        .append(\"circle\")\r\n        .attr(\"class\", \"circle\")\r\n        .attr(\"r\", 25)\r\n        .attr(\r\n          \"fill\",\r\n          (d) => this.config.colors[this.config.getNodeClassIndex(d.labels)]\r\n        )\r\n        .attr(\r\n          \"stroke\",\r\n          (d) =>\r\n            this.config.borderColors[this.config.getNodeClassIndex(d.labels)]\r\n        ),\r\n      label: nodes.append(\"text\").text((d) => this.config.getNodeText(d)),\r\n    };\r\n\r\n    return nodes;\r\n  }\r\n\r\n  initLinks(dataLinks) {\r\n    var links = this.container\r\n      .selectAll(\".link\")\r\n      .data(dataLinks)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"link\");\r\n\r\n    this.linkGroup = {\r\n      glow: links.append(\"path\").attr(\"class\", \"glow\"),\r\n      arrow: links.append(\"path\").attr(\"class\", \"arrow\"),\r\n      text: links.append(\"text\").text((d) => d[this.config.linkLabelProperty]),\r\n    };\r\n\r\n    return links;\r\n  }\r\n\r\n  registerInteraction(dataLinks) {\r\n    const that = this;\r\n\r\n    this.nodesLinked = [];\r\n    dataLinks.forEach(function (d) {\r\n      that.nodesLinked[d.source.index + \"-\" + d.target.index] = true;\r\n      that.nodesLinked[d.target.index + \"-\" + d.source.index] = true;\r\n    });\r\n\r\n    this.links\r\n      .on(\"mouseenter\", function (d) {\r\n        that.handler.focusLink(d);\r\n        that.config.linkMouseEnter && that.config.linkMouseEnter(d, that);\r\n      })\r\n      .on(\"mouseleave\", function (d) {\r\n        that.handler.removeFocus(that.nodes, that.links);\r\n        that.config.linkMouseLeave && that.config.linkMouseLeave(d, that);\r\n      });\r\n\r\n    this.nodes\r\n      .on(\"contextmenu\", (d) => {\r\n        that.handler.pinNode(that.nodes, d);\r\n        d.fx = d.x;\r\n        d.fy = d.y;\r\n      })\r\n      .on(\"mouseenter\", function (d) {\r\n        that.handler.focusNode(d);\r\n        that.config.nodeMouseEnter && that.config.nodeMouseEnter(d, that);\r\n      })\r\n      .on(\"mouseleave\", function (d) {\r\n        that.handler.removeFocus(that.nodes, that.links);\r\n        that.config.nodeMouseLeave && that.config.nodeMouseLeave(d, that);\r\n      });\r\n\r\n    this.svg\r\n      .on(\"contextmenu\", () => d3.event.preventDefault())\r\n      .call(this.handler.zoom());\r\n    this.svg.on(\"dblclick.zoom\", null);\r\n  }\r\n\r\n  renderTick() {\r\n    this.simulation.on(\"tick\", () => {\r\n      this.renderer.renderLink(\r\n        this.links,\r\n        this.linkGroup.glow,\r\n        this.linkGroup.text\r\n      );\r\n      this.nodes.attr(\"transform\", (d) => `translate(${d.x}, ${d.y})`);\r\n    });\r\n  }\r\n}\r\n\nclass Config {\r\n  nodeMouseEnter = null; \r\n  nodeMouseLeave = null; \r\n  linkMouseEnter = null; \r\n  linkMouseLeave = null; \r\n\r\n  colors = [\r\n    \"#68bdf6\",\r\n    \"#6dce9e\",\r\n    \"#faafc2\",\r\n    \"#f2baf6\",\r\n    \"#ff928c\",\r\n    \"#fcea7e\",\r\n    \"#ffc766\",\r\n    \"#405f9e\",\r\n    \"#a5abb6\",\r\n    \"#78cecb\",\r\n    \"#b88cbb\",\r\n    \"#ced2d9\",\r\n    \"#e84646\",\r\n    \"#fa5f86\",\r\n    \"#ffab1a\",\r\n    \"#fcda19\",\r\n    \"#797b80\",\r\n    \"#c9d96f\",\r\n    \"#47991f\",\r\n    \"#70edee\",\r\n    \"#ff75ea\",\r\n  ];\r\n\r\n  linkSourceKey = \"source\";\r\n  linkTargetKey = \"target\";\r\n  nodeGroupsKey = \"group\";\r\n\r\n  linkLabelProperty = \"type\";\r\n  nodeLabelProperties = null;\r\n\r\n\r\n  constructor(graph, ...configs) {\r\n    const that = this;\r\n    if (configs) {\r\n      for (let config of configs) {\r\n        Object.entries(config).forEach(([k, v]) => (that[k] = v));\r\n      }\r\n    }\r\n\r\n    this.graph = graph;\r\n\r\n    this.borderColors = this.colors.map((c) => d3.rgb(c).darker(0.5));\r\n\r\n  }\r\n\r\n  getNodeLabel(labels) {\r\n    return labels.constructor === Array ? labels[0] : labels;\r\n  }\r\n\r\n  getNodeClassIndex(labels) {\r\n    return this.graph.existedGroups[this.getNodeLabel(labels)];\r\n  }\r\n\r\n  getNodeText(d) {\r\n    return d.properties[this.nodeLabelProperties[this.getNodeLabel(d.labels)]];\r\n  }\r\n}\r\n\nclass Handler {\r\n  constructor(graph) {\r\n    this.graph = graph;\r\n  }\r\n\r\n  focusLink(d) {\r\n    this.graph.nodes.each(function(i) {\r\n      if (i.index == d.source.index || i.index == d.target.index) return;\r\n      this.classList.add(\"faded\");\r\n    });\r\n    this.graph.links.each(function(i) {\r\n      if (i.source.index == d.source.index && i.target.index == d.target.index)\r\n        return;\r\n      this.classList.add(\"faded\");\r\n    });\r\n  }\r\n\r\n  focusNode(d) {\r\n\r\n    const that = this;\r\n    this.graph.nodes.each(function(i) {\r\n      if (i.index == d.index || that.graph.nodesLinked[i.index + \"-\" + d.index])\r\n        return;\r\n      this.classList.add(\"faded\");\r\n    });\r\n    this.graph.links.each(function(i) {\r\n      if (i.source.index == d.index || i.target.index == d.index) return;\r\n      this.classList.add(\"faded\");\r\n    });\r\n  }\r\n\r\n  removeFocus() {\r\n    this.graph.nodes.each(function() {\r\n      this.classList.remove(\"faded\");\r\n    });\r\n    this.graph.links.each(function() {\r\n      this.classList.remove(\"faded\");\r\n    });\r\n  }\r\n\r\n  pinNode(node, d) {\r\n    this.graph.nodes.each(function(i) {\r\n      if (i.index !== d.index) return;\r\n      this.classList.add(\"pinned\");\r\n    });\r\n  }\r\n\r\n  removeNodePin(d) {\r\n    this.graph.nodes.each(function(i) {\r\n      if (i.index !== d.index) return;\r\n      this.classList.remove(\"pinned\");\r\n    });\r\n  }\r\n\r\n  zoom() {\r\n    const that = this;\r\n    return d3\r\n      .zoom()\r\n      .scaleExtent([0.1, 2])\r\n      .on(\"zoom\", () => {\r\n        const scale = +d3.event.transform.k;\r\n        that.graph.nodeGroup.label.attr(\r\n          \"opacity\",\r\n          scale > 0.5 ? 1 : scale < 0.4 ? 0 : (scale - 0.4) * 10\r\n        );\r\n        that.graph.linkGroup.text.attr(\r\n          \"opacity\",\r\n          scale > 0.5 ? 1 : scale < 0.4 ? 0 : (scale - 0.4) * 10\r\n        );\r\n        that.graph.container.attr(\"transform\", d3.event.transform);\r\n      });\r\n  }\r\n\r\n  drag(simulation) {\r\n    const that = this;\r\n\r\n    function dragstarted(d) {\r\n      if (!d3.event.active) simulation.alphaTarget(0.3).restart();\r\n      that.removeNodePin(d);\r\n      d.fx = d.x;\r\n      d.fy = d.y;\r\n    }\r\n\r\n    function dragged(d) {\r\n      d.fx = d3.event.x;\r\n      d.fy = d3.event.y;\r\n    }\r\n\r\n    function dragended(d) {\r\n      if (!d3.event.active) simulation.alphaTarget(0);\r\n      d.fx = null;\r\n      d.fy = null;\r\n    }\r\n\r\n    return d3\r\n      .drag()\r\n      .on(\"start\", dragstarted)\r\n      .on(\"drag\", dragged)\r\n      .on(\"end\", dragended);\r\n  }\r\n}\r\n\nclass Renderer {\r\n    utils = new Utils();\r\n\r\n      renderLink(link, linkGlow, linkText) {\r\n      const that = this;\r\n\r\n        link.attr(\"transform\", function (d) {\r\n        var angle = that.utils.rotation(d.source, d.target);\r\n        return (\r\n          \"translate(\" +\r\n          d.source.x +\r\n          \", \" +\r\n          d.source.y +\r\n          \") rotate(\" +\r\n          angle +\r\n          \")\"\r\n        );\r\n      });\r\n\r\n        const options = {\r\n        nodeRadius: 25,\r\n        arrowSize: 4,\r\n      };\r\n\r\n        this.renderLinkText(linkText);\r\n      this.renderLinkGlow(linkGlow);\r\n      this.renderLinkArrow(link, options);\r\n    }\r\n\r\n      renderLinkArrow(link, options) {\r\n      const that = this;\r\n\r\n        link.each(function () {\r\n        var rel = d3.select(this),\r\n          outline = rel.select(\".arrow\"),\r\n          text = rel.select(\"text\");\r\n\r\n          outline.attr(\"d\", function (d) {\r\n          var center = { x: 0, y: 0 },\r\n            angle = that.utils.rotation(d.source, d.target),\r\n            textBoundingBox = text.node().getBBox(),\r\n            textPadding = 5,\r\n            u = that.utils.unitaryVector(d.source, d.target),\r\n            textMargin = {\r\n              x:\r\n                (d.target.x -\r\n                  d.source.x -\r\n                  (textBoundingBox.width + textPadding) * u.x) *\r\n                0.5,\r\n              y:\r\n                (d.target.y -\r\n                  d.source.y -\r\n                  (textBoundingBox.width + textPadding) * u.y) *\r\n                0.5,\r\n            },\r\n            n = that.utils.unitaryNormalVector(d.source, d.target),\r\n            rotatedPointA1 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x: 0 + (options.nodeRadius + 1) * u.x - n.x,\r\n                y: 0 + (options.nodeRadius + 1) * u.y - n.y,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointB1 = that.utils.rotatePoint(\r\n              center,\r\n              { x: textMargin.x - n.x, y: textMargin.y - n.y },\r\n              angle\r\n            ),\r\n            rotatedPointC1 = that.utils.rotatePoint(\r\n              center,\r\n              { x: textMargin.x, y: textMargin.y },\r\n              angle\r\n            ),\r\n            rotatedPointD1 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x: 0 + (options.nodeRadius + 1) * u.x,\r\n                y: 0 + (options.nodeRadius + 1) * u.y,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointA2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x: d.target.x - d.source.x - textMargin.x - n.x,\r\n                y: d.target.y - d.source.y - textMargin.y - n.y,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointB2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x:\r\n                  d.target.x -\r\n                  d.source.x -\r\n                  (options.nodeRadius + 1) * u.x -\r\n                  n.x -\r\n                  u.x * options.arrowSize,\r\n                y:\r\n                  d.target.y -\r\n                  d.source.y -\r\n                  (options.nodeRadius + 1) * u.y -\r\n                  n.y -\r\n                  u.y * options.arrowSize,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointC2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x:\r\n                  d.target.x -\r\n                  d.source.x -\r\n                  (options.nodeRadius + 1) * u.x -\r\n                  n.x +\r\n                  (n.x - u.x) * options.arrowSize,\r\n                y:\r\n                  d.target.y -\r\n                  d.source.y -\r\n                  (options.nodeRadius + 1) * u.y -\r\n                  n.y +\r\n                  (n.y - u.y) * options.arrowSize,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointD2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x: d.target.x - d.source.x - (options.nodeRadius + 1) * u.x,\r\n                y: d.target.y - d.source.y - (options.nodeRadius + 1) * u.y,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointE2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x:\r\n                  d.target.x -\r\n                  d.source.x -\r\n                  (options.nodeRadius + 1) * u.x +\r\n                  (-n.x - u.x) * options.arrowSize,\r\n                y:\r\n                  d.target.y -\r\n                  d.source.y -\r\n                  (options.nodeRadius + 1) * u.y +\r\n                  (-n.y - u.y) * options.arrowSize,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointF2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x:\r\n                  d.target.x -\r\n                  d.source.x -\r\n                  (options.nodeRadius + 1) * u.x -\r\n                  u.x * options.arrowSize,\r\n                y:\r\n                  d.target.y -\r\n                  d.source.y -\r\n                  (options.nodeRadius + 1) * u.y -\r\n                  u.y * options.arrowSize,\r\n              },\r\n              angle\r\n            ),\r\n            rotatedPointG2 = that.utils.rotatePoint(\r\n              center,\r\n              {\r\n                x: d.target.x - d.source.x - textMargin.x,\r\n                y: d.target.y - d.source.y - textMargin.y,\r\n              },\r\n              angle\r\n            );\r\n\r\n            return (\r\n            \"M \" +\r\n            rotatedPointA1.x +\r\n            \" \" +\r\n            rotatedPointA1.y +\r\n            \" L \" +\r\n            rotatedPointB1.x +\r\n            \" \" +\r\n            rotatedPointB1.y +\r\n            \" L \" +\r\n            rotatedPointC1.x +\r\n            \" \" +\r\n            rotatedPointC1.y +\r\n            \" L \" +\r\n            rotatedPointD1.x +\r\n            \" \" +\r\n            rotatedPointD1.y +\r\n            \" Z M \" +\r\n            rotatedPointA2.x +\r\n            \" \" +\r\n            rotatedPointA2.y +\r\n            \" L \" +\r\n            rotatedPointB2.x +\r\n            \" \" +\r\n            rotatedPointB2.y +\r\n            \" L \" +\r\n            rotatedPointC2.x +\r\n            \" \" +\r\n            rotatedPointC2.y +\r\n            \" L \" +\r\n            rotatedPointD2.x +\r\n            \" \" +\r\n            rotatedPointD2.y +\r\n            \" L \" +\r\n            rotatedPointE2.x +\r\n            \" \" +\r\n            rotatedPointE2.y +\r\n            \" L \" +\r\n            rotatedPointF2.x +\r\n            \" \" +\r\n            rotatedPointF2.y +\r\n            \" L \" +\r\n            rotatedPointG2.x +\r\n            \" \" +\r\n            rotatedPointG2.y +\r\n            \" Z\"\r\n          );\r\n        });\r\n      });\r\n    }\r\n\r\n      renderLinkGlow(linkGlow) {\r\n      const that = this;\r\n      linkGlow.attr(\"d\", function (d) {\r\n        var center = { x: 0, y: 0 },\r\n          angle = that.utils.rotation(d.source, d.target),\r\n          n = that.utils.unitaryNormalVector(d.source, d.target),\r\n          rotatedPointA = that.utils.rotatePoint(\r\n            center,\r\n            { x: 0 - n.x, y: 0 - n.y },\r\n            angle\r\n          ),\r\n          rotatedPointB = that.utils.rotatePoint(\r\n            center,\r\n            {\r\n              x: d.target.x - d.source.x - n.x,\r\n              y: d.target.y - d.source.y - n.y,\r\n            },\r\n            angle\r\n          ),\r\n          rotatedPointC = that.utils.rotatePoint(\r\n            center,\r\n            {\r\n              x: d.target.x - d.source.x,\r\n              y: d.target.y - d.source.y,\r\n            },\r\n            angle\r\n          ),\r\n          rotatedPointD = that.utils.rotatePoint(center, { x: 0, y: 0 }, angle);\r\n\r\n          return (\r\n          \"M \" +\r\n          rotatedPointA.x +\r\n          \" \" +\r\n          rotatedPointA.y +\r\n          \" L \" +\r\n          rotatedPointB.x +\r\n          \" \" +\r\n          rotatedPointB.y +\r\n          \" L \" +\r\n          rotatedPointC.x +\r\n          \" \" +\r\n          rotatedPointC.y +\r\n          \" L \" +\r\n          rotatedPointD.x +\r\n          \" \" +\r\n          rotatedPointD.y +\r\n          \" Z\"\r\n        );\r\n      });\r\n    }\r\n\r\n      renderLinkText(linkText) {\r\n      const that = this;\r\n      linkText.attr(\"transform\", function (d) {\r\n        var angle = (that.utils.rotation(d.source, d.target) + 360) % 360,\r\n          mirror = angle > 90 && angle < 270,\r\n          center = { x: 0, y: 0 },\r\n          n = that.utils.unitaryNormalVector(d.source, d.target),\r\n          nWeight = mirror ? 2 : -3,\r\n          point = {\r\n            x: (d.target.x - d.source.x) * 0.5 + n.x * nWeight,\r\n            y: (d.target.y - d.source.y) * 0.5 + n.y * nWeight,\r\n          },\r\n          rotatedPoint = that.utils.rotatePoint(center, point, angle);\r\n\r\n          return (\r\n          \"translate(\" +\r\n          rotatedPoint.x +\r\n          \", \" +\r\n          rotatedPoint.y +\r\n          \") rotate(\" +\r\n          (mirror ? 180 : 0) +\r\n          \")\"\r\n        );\r\n      });\r\n    }\r\n  }\nconst unique = (array) => array.filter((v, i, a) => a.indexOf(v) === i);\r\n\r\nfunction renameItemDict(original, keys) {\r\n  return original.map(\r\n    (i) =>\r\n      Object.entries(keys).map(([k, v]) => {\r\n        if (k === v) return i;\r\n        Object.defineProperty(i, k, Object.getOwnPropertyDescriptor(i, v));\r\n        delete i[v];\r\n        return i;\r\n      })[0]\r\n  );\r\n}\r\n\r\nclass Utils {\r\n  rotation(source, target) {\r\n    return (\r\n      (Math.atan2(target.y - source.y, target.x - source.x) * 180) / Math.PI\r\n    );\r\n  }\r\n\r\n  unitaryVector(source, target, newLength) {\r\n    var length =\r\n      Math.sqrt(\r\n        Math.pow(target.x - source.x, 2) + Math.pow(target.y - source.y, 2)\r\n      ) / Math.sqrt(newLength || 1);\r\n\r\n    return {\r\n      x: (target.x - source.x) / length,\r\n      y: (target.y - source.y) / length,\r\n    };\r\n  }\r\n\r\n  unitaryNormalVector(source, target, newLength) {\r\n    var center = { x: 0, y: 0 },\r\n      vector = this.unitaryVector(source, target, newLength);\r\n\r\n    return this.rotatePoint(center, vector, 90);\r\n  }\r\n\r\n  rotate(cx, cy, x, y, angle) {\r\n    var radians = (Math.PI / 180) * angle,\r\n      cos = Math.cos(radians),\r\n      sin = Math.sin(radians),\r\n      nx = cos * (x - cx) + sin * (y - cy) + cx,\r\n      ny = cos * (y - cy) - sin * (x - cx) + cy;\r\n\r\n    return { x: nx, y: ny };\r\n  }\r\n\r\n  rotatePoint(c, p, angle) {\r\n    return this.rotate(c.x, c.y, p.x, p.y, angle);\r\n  }\r\n}\r\n"]}